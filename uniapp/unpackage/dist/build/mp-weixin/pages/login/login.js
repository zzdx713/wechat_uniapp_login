(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{4020:function(e,n,t){},4915:function(e,n,t){"use strict";t.r(n);var o=t("bb5d"),r=t.n(o);for(var c in o)["default"].indexOf(c)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(c);n["default"]=r.a},"5b99":function(e,n,t){"use strict";t.d(n,"b",(function(){return o})),t.d(n,"c",(function(){return r})),t.d(n,"a",(function(){}));var o=function(){var e=this.$createElement;this._self._c},r=[]},"6cc3":function(e,n,t){"use strict";t.r(n);var o=t("5b99"),r=t("4915");for(var c in r)["default"].indexOf(c)<0&&function(e){t.d(n,e,(function(){return r[e]}))}(c);t("c8b8");var i=t("828b"),a=Object(i["a"])(r["default"],o["b"],o["c"],!1,null,"91f7d82a",null,!1,o["a"],void 0);n["default"]=a.exports},bb5d:function(e,n,t){"use strict";(function(e){var o=t("47a9");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=o(t("7eb4")),c=o(t("ee10")),i=o(t("7ca3")),a=t("b72f"),u=t("8f59");function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function f(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){(0,i.default)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var l={data:function(){return{isLogining:!1}},methods:f(f({},(0,u.mapMutations)(["SET_TOKEN","SET_USER"])),{},{onLogin:function(n){var t=this;return(0,c.default)(r.default.mark((function n(){var o,c,i,a,u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.isLogining){n.next=2;break}return n.abrupt("return");case 2:return t.isLogining=!0,n.prev=3,n.next=6,t.getWxCode();case 6:return o=n.sent,n.next=9,t.loginToOdoo(o);case 9:c=n.sent,console.log("【DEBUG】登录接口响应:",c),c&&200===c.code?(i=c.token,a=c.partner_id,u=c.name,t.SET_TOKEN(i),t.SET_USER({id:a,name:u}),e.switchTab({url:"/pages/index/index"})):e.showToast({title:c.message||"登录失败",icon:"none"}),n.next=18;break;case 14:n.prev=14,n.t0=n["catch"](3),console.error("【ERROR】登录异常:",n.t0),e.showToast({title:"登录失败，请重试",icon:"none"});case 18:return n.prev=18,t.isLogining=!1,n.finish(18);case 21:case"end":return n.stop()}}),n,null,[[3,14,18,21]])})))()},getWxCode:function(){return new Promise((function(n,t){e.login({provider:"weixin",success:function(e){e.code?(console.log("✅ 获取到 code:",e.code),n(e.code)):(console.error("❌ 获取 code 失败:",e),t("获取 code 失败"))},fail:function(n){console.error("❌ uni.login 失败:",n),e.showToast({title:"微信登录失败",icon:"none"}),t(n)}})}))},loginToOdoo:function(e){return(0,a.post)("/wechat/miniapp/login",{code:e})}})};n.default=l}).call(this,t("df3c")["default"])},bd02:function(e,n,t){"use strict";(function(e,n){var o=t("47a9");t("22eb");o(t("3240"));var r=o(t("6cc3"));e.__webpack_require_UNI_MP_PLUGIN__=t,n(r.default)}).call(this,t("3223")["default"],t("df3c")["createPage"])},c8b8:function(e,n,t){"use strict";var o=t("4020"),r=t.n(o);r.a}},[["bd02","common/runtime","common/vendor"]]]);